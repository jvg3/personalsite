/*
 *  fluid - v1.0.0
 *  A full page scroll plugin.
 *  https://bitbucket.org/robneyland/fluid
 *
 *  Made by Rob Neyland
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="fluidscroll",g={scrollStiffness:1,linkClass:"fluid-link",afterRender:function(){},onLeave:function(){},onBetween:function(){}};a.extend(e.prototype,{init:function(){this.buildCache().buildLayout().bindMenu().bindScroll().updateMenu(),this.settings.afterRender.call(this)},buildCache:function(){return this.fluid=a(this.element),this.surface=this.fluid.find(".fluid-surface"),this.frames=this.surface.find(".fluid-frame"),this.anchors=a.map(this.frames,function(b){return"#"+a(b).data("anchor")}),this.footer=this.fluid.find(".fluid-footer"),this.menu=this.fluid.find(".fluid-menu"),this.menuItems=this.menu.find(".fluid-menu-item"),this.links=a("."+this.settings.linkClass).add(this.menuItems.find("a")),this.currentPosition=this.anchors.indexOf(b.location.hash),this.currentPosition=this.currentPosition===-1?0:this.currentPosition,this.currentFrame=this.frames.eq(this.currentPosition),this.currentMenuItem=this.menuItems.eq(this.currentPosition),this.totalPositions=this.frames.length+(this.footer.length>0?1:0),this.direction="down",this},buildLayout:function(){return a("html, body").css({margin:0,padding:0,height:"100%"}),a("html").css("overflow","hidden"),a("body").css("overflow","auto"),this.surface.append("<div class='fluid-overlay'></div>"),this.overlay=this.surface.find(".fluid-overlay"),this.fluid.css({position:"relative",height:"100%",overflow:"hidden"}),this.surface.css({overflow:"hidden",position:"absolute",height:"100%",top:0,bottom:0,left:0,right:0}),TweenMax.set(this.frames,{bottom:0,left:0,position:"absolute",right:0,top:0}),TweenMax.set(this.frames.not(":eq("+this.currentPosition+")"),{y:"100%"}),TweenMax.set(this.overlay,{backgroundColor:"#fff",left:0,position:"absolute",top:0,height:"100%",width:"100%",y:"100%",zIndex:100}),TweenMax.set(this.footer,{position:"absolute",top:"100%",width:"100%",left:0,zIndex:10}),this},bindMenu:function(){var b=this;return this.footer.length>0&&this.anchors.indexOf("#footer")===-1&&this.anchors.push("#footer"),this.links.on("click",function(c){return c.preventDefault(),b.moveTo(b.anchors.indexOf(a(this).attr("href"))),!1}),this},bindScroll:function(){var a=this;return this.fluid.off("mousewheel DOMMouseScroll"),setTimeout(function(){a.fluid.on("mousewheel",function(b){b.stopPropagation();var c=b.originalEvent.wheelDelta;c<10*-a.settings.scrollStiffness?a.next():c>10*a.settings.scrollStiffness&&a.prev()}),a.fluid.on("DOMMouseScroll",function(b){b.stopPropagation();var c=b.originalEvent.detail;c<-a.settings.scrollStiffness?a.prev():c>a.settings.scrollStiffness&&a.next()})},100),this},validate:function(a){return a<this.totalPositions&&a>-1&&(this.direction=a<this.currentPosition?"up":"down",this.currentPosition=a,this.currentFrame=this.frames.eq(a),this.currentMenuItem=this.menuItems.eq(a),!0)},moveTo:function(a){var b=this.currentPosition;this.validate(a)&&(this.footer.length>0&&this.currentPosition===this.totalPositions-1?(this.fluid.off("mousewheel DOMMouseScroll"),this.showFooter()):this.footer.length>0&&this.currentPosition===this.totalPositions-2&&"up"===this.direction?(this.fluid.off("mousewheel DOMMouseScroll"),this.hideFooter()):(this.fluid.off("mousewheel DOMMouseScroll"),this.moveToFrame(b)))},moveToFrame:function(a){this.settings.onLeave.call(this,this.frames.eq(a),this.currentFrame);var b=this,c="up"===this.direction?-1:1;TweenMax.set(b.overlay,{y:100*c+"%"});var d=new TimelineMax({onComplete:function(){b.bindScroll()}});return d.add([TweenMax.to(this.footer,.5,{y:0}),TweenMax.to(this.frames.eq(a),.45,{y:c*-1*10+"%",ease:Power1.easeOut}),TweenMax.to(this.overlay,.5,{y:"0%",ease:Power2.easeOut,onComplete:function(){b.updateMenu().updateHistory(),b.settings.onBetween.call(b,b.frames.eq(a),b.currentFrame)}})]),d.add([TweenMax.to(this.frames.eq(a),.1,{y:"100%"}),TweenMax.to(this.currentFrame,.1,{y:10*c+"%"})]),d.add([TweenMax.to(this.currentFrame,.45,{y:"0%",ease:Power1.easeOut}),TweenMax.to(this.overlay,.5,{y:c*-1*100+"%",ease:Power2.easeOut})]),this},showFooter:function(){var a=this;return this.menu.hide(),TweenMax.to(this.surface,.5,{opacity:.25,ease:Power3.easeInOut}),TweenMax.to(this.frames.eq(this.currentPosition-1),.5,{y:-this.footer.height(),ease:Power3.easeInOut}),TweenMax.to(this.footer,.5,{y:-this.footer.height(),ease:Power3.easeInOut,onComplete:function(){a.bindScroll()}}),this},hideFooter:function(){var a=this;return this.menu.show(),TweenMax.to(this.surface,.5,{opacity:1,ease:Power3.easeInOut}),TweenMax.to(this.frames.eq(this.currentPosition),.5,{y:"0%",ease:Power3.easeInOut}),TweenMax.to(this.footer,.5,{y:0,ease:Power3.easeInOut,onComplete:function(){setTimeout(function(){a.bindScroll()},600)}}),this},prev:function(){return this.moveTo(this.currentPosition-1),this},next:function(){return this.moveTo(this.currentPosition+1),this},updateMenu:function(){return this.menuItems.not(this.currentMenuItem).removeClass("active"),this.currentMenuItem.addClass("active"),this},updateHistory:function(){return history.replaceState({},"","#"+this.currentFrame.data("anchor")),this}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);